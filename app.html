<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Fujisan.AI ‚Äî JLPT Learning</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="48x48" href="/images/favicon-48.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#005BAC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Fujisan.AI">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  
  <!-- Fonts (Design Guideline) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-vertexai-preview.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- LOADING OVERLAY - Smooth transition from LP -->
<div id="app-loading-overlay" style="
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  transition: opacity 0.3s ease-out;
">
  <div style="text-align: center;">
    <!-- Fuji Logo -->
    <svg viewBox="0 0 24 24" width="80" height="80" style="margin-bottom: 16px;">
      <path fill="white" d="M12 4L2 20h20L12 4zm0 4l6 10H6l6-10z"/>
      <path fill="rgba(255,255,255,0.3)" d="M12 4L8 10h8L12 4z"/>
    </svg>
    <div style="color: white; font-size: 24px; font-weight: 700; margin-bottom: 8px;">Fujisan.AI</div>
    <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Loading your study progress...</div>
    <!-- Spinner -->
    <div style="margin-top: 24px;">
      <div style="
        width: 32px;
        height: 32px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto;
      "></div>
    </div>
  </div>
</div>
<style>
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>

<!-- ONBOARDING -->
<div id="onboarding-overlay" class="onboarding-overlay" style="display:none;">
  <div class="onboarding-container">
    <!-- Step indicators -->
    <div class="onboarding-dots">
      <span class="onboarding-dot active" data-step="1"></span>
      <span class="onboarding-dot" data-step="2"></span>
      <span class="onboarding-dot" data-step="3"></span>
      <span class="onboarding-dot" data-step="4"></span>
    </div>
    
    <!-- Step 1: Welcome -->
    <div class="onboarding-step active" data-step="1">
      <div class="onboarding-icon">
        <svg viewBox="0 0 24 24" width="80" height="80">
          <path fill="#005BAC" d="M12 4L2 20h20L12 4zm0 4l6 10H6l6-10z"/>
          <path fill="#e6f0f9" d="M12 4L8 10h8L12 4z"/>
        </svg>
      </div>
      <h1 class="onboarding-title">Welcome to Fujisan.AI</h1>
      <p class="onboarding-desc">Your AI-powered JLPT tutor. Master Japanese with personalized learning.</p>
    </div>
    
    <!-- Step 2: Select Level -->
    <div class="onboarding-step" data-step="2">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div>
      <h1 class="onboarding-title">What's your goal?</h1>
      <p class="onboarding-desc">Select your target JLPT level</p>
      <div class="onboarding-levels">
        <button class="onboarding-level-btn" data-level="N5" onclick="selectOnboardingLevel('N5')">
          <span class="level-tag n5">N5</span>
          <span class="level-name">Beginner</span>
        </button>
        <button class="onboarding-level-btn" data-level="N4" onclick="selectOnboardingLevel('N4')">
          <span class="level-tag n4">N4</span>
          <span class="level-name">Elementary</span>
        </button>
        <button class="onboarding-level-btn" data-level="N3" onclick="selectOnboardingLevel('N3')">
          <span class="level-tag n3">N3</span>
          <span class="level-name">Intermediate</span>
        </button>
        <button class="onboarding-level-btn" data-level="N2" onclick="selectOnboardingLevel('N2')">
          <span class="level-tag n2">N2</span>
          <span class="level-name">Advanced</span>
        </button>
        <button class="onboarding-level-btn" data-level="N1" onclick="selectOnboardingLevel('N1')">
          <span class="level-tag n1">N1</span>
          <span class="level-name">Expert</span>
        </button>
      </div>
    </div>
    
    <!-- Step 3: Features -->
    <div class="onboarding-step" data-step="3">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
      <h1 class="onboarding-title">3 Ways to Learn</h1>
      <div class="onboarding-features">
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div>
          <div class="feature-text">
            <strong>Drill</strong>
            <span>Daily vocabulary, kanji & grammar practice</span>
          </div>
        </div>
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
          <div class="feature-text">
            <strong>Mock Test</strong>
            <span>Real JLPT format with 20 practice sets</span>
          </div>
        </div>
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="8.5" cy="15.5" r="1.5" fill="#667eea"/><circle cx="15.5" cy="15.5" r="1.5" fill="#667eea"/><path d="M12 2v5M8 4l4 3 4-3"/></svg></div>
          <div class="feature-text">
            <strong>AI Tutor</strong>
            <span>Get personalized explanations for mistakes</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Step 4: Ready -->
    <div class="onboarding-step" data-step="4">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg></div>
      <h1 class="onboarding-title">You're all set!</h1>
      <p class="onboarding-desc">Start with Unit 1 and let AI guide your journey to JLPT success.</p>
      <div class="onboarding-tip">
        <strong>üí° Pro Tip:</strong> Complete at least 1 unit daily for best results
      </div>
    </div>
    
    <!-- Navigation -->
    <div class="onboarding-nav">
      <button class="onboarding-skip" onclick="skipOnboarding()">Skip</button>
      <button class="onboarding-next" onclick="nextOnboardingStep()">
        <span id="onboarding-next-text">Next</span>
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="screen-drill" class="screen active dashboard-fixed">
  <div class="header">
    <div class="logo" onclick="goHome()" style="cursor:pointer"><img src="/images/logo.png" alt="Fujisan.AI" class="logo-img" style="height:130px;"></div>
    <div class="header-right">
      <select class="lang-selector" id="lang-select" onchange="changeLang(this.value)">
        <option value="en">EN</option>
        <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="id" disabled>Indonesia (Ê∫ñÂÇô‰∏≠)</option>
      </select>
      <button class="header-btn" onclick="event.stopPropagation(); showScreen('settings')"><svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align:-2px"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>
  
  <!-- Level Selector (TOP) -->
  <div class="dash-level-row" id="drill-level-row">
    <button class="level-select-btn active" data-level="N5">N5</button>
    <button class="level-select-btn" data-level="N4">N4</button>
    <button class="level-select-btn" data-level="N3">N3</button>
    <button class="level-select-btn" data-level="N2">N2</button>
    <button class="level-select-btn" data-level="N1">N1</button>
  </div>
  
  <!-- NAV BAR (3 items: Drill, Mock, AI) -->
  <nav class="nav-bar nav-bar-3">
    <button class="nav-btn active" data-screen="drill"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M4 4h6c1.1 0 2 .9 2 2v14c0-.55-.45-1-1-1H4V4zm16 0h-6c-1.1 0-2 .9-2 2v14c0-.55.45-1 1-1h7V4z"/></svg></span>Drill</button>
    <button class="nav-btn" data-screen="mock"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg></span>Mock</button>
    <button class="nav-btn" data-screen="ai"><span class="nav-icon ai-nav-icon"></span>AI</button>
  </nav>
  
  <!-- MAIN CONTENT AREA (Fixed Layout) -->
  <div class="dashboard-content">
    <!-- Continue Button (shows if last session exists) -->
    <button class="continue-btn" id="continue-btn" onclick="continueLastSession()" style="display:none;">
      <svg class="sf-icon" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
      <span id="continue-btn-text">Continue</span>
    </button>
    
    <!-- Unit Grid -->
    <div class="dash-unit-section">
      <div class="unit-grid" id="unit-grid"></div>
    </div>
    
    <!-- Category Buttons (tap to start quiz) -->
    <div class="category-row">
      <button class="category-btn" data-cat="vocab" onclick="selectCategoryAndStart('vocab')"><div class="category-icon"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg></div><div class="category-name" data-i18n="vocab">Vocab</div></button>
      <button class="category-btn" data-cat="kanji" onclick="selectCategoryAndStart('kanji')"><div class="category-icon"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M5 4v3h5.5v12h3V7H19V4H5z"/></svg></div><div class="category-name" data-i18n="new_kanji">New Kanji</div></button>
      <button class="category-btn" data-cat="grammar" onclick="selectCategoryAndStart('grammar')"><div class="category-icon"><svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg></div><div class="category-name" data-i18n="grammar">Grammar</div></button>
    </div>
    
    <!-- SRS Stats Display -->
    <div id="srs-stats-container" class="srs-stats-container" style="display:none"></div>
  </div>
</div>

<!-- QUIZ (All Modes) -->
<div id="screen-quiz" class="screen quiz-screen">
  <div class="q-header">
    <button class="back-btn" onclick="confirmExit()">‚Üê</button>
    <div class="q-title" id="quiz-title">Drill</div>
    <div class="skill-badge" id="skill-badge">üëÇ Listening</div>
    <button class="review-header-btn" id="review-header-btn" onclick="startReview()" style="display:none">üîÑ <span id="review-header-count">0</span></button>
    <div class="q-progress" id="quiz-progress">1/10</div>
  </div>
  <div class="q-card compact">
    <div class="q-prompt" id="quiz-prompt">What does this mean?</div>
    <div class="q-word" id="quiz-word">-</div>
    <div class="q-reading" id="quiz-reading">-</div>
    <button class="audio-btn" id="quiz-audio-btn" onclick="playAudio()" style="display:none">üîä Play</button>
  </div>
  <div class="options compact" id="quiz-options"></div>
  
  <!-- Feedback Area (shows after answer) -->
  <div class="feedback-area" id="feedback-area" style="display:none">
    <div class="feedback-result" id="feedback-result">
      <span class="feedback-icon"></span>
      <span class="feedback-text"></span>
    </div>
    <div class="feedback-answer" id="feedback-answer"></div>
    
    <!-- AI Auto Comment (for wrong answers) -->
    <div class="feedback-ai-section" id="feedback-ai-section" style="display:none">
      <div class="feedback-ai-comment" id="feedback-ai-comment">
        <div class="ai-comment-loading">ü§ñ Loading...</div>
      </div>
      
      <!-- Follow-up Question Input -->
      <div class="feedback-followup">
        <input type="text" class="followup-input" id="followup-input" placeholder="Ask a follow-up question...">
        <button class="followup-btn" id="followup-btn" onclick="askFollowup()">‚Üí</button>
      </div>
      <div class="followup-response" id="followup-response" style="display:none"></div>
    </div>
  </div>
  
  <!-- Next Button (fixed at bottom, outside feedback-area) -->
  <button class="feedback-next-btn" id="feedback-next-btn" onclick="advanceToNextQuestion()" style="display:none">Ê¨°„Å∏ ‚Üí</button>
</div>

<!-- RESULT -->
<div id="screen-result" class="screen">
  <div class="result-card" id="result-card">
    <div class="result-icon" id="result-icon">‚úì</div>
    <div class="result-score" id="result-score">0%</div>
    <div class="result-label" id="result-label">-</div>
    <div class="result-praise" id="result-praise"></div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-value" id="result-correct">0</div><div class="result-stat-label">Correct</div></div>
      <div class="result-stat"><div class="result-stat-value" id="result-wrong">0</div><div class="result-stat-label">Wrong</div></div>
      <div class="result-stat"><div class="result-stat-value" id="result-time">0:00</div><div class="result-stat-label">Time</div></div>
    </div>
  </div>
  
  <!-- Wrong Answers with AI Explanation -->
  <div class="wrong-answers-section" id="wrongAnswersSection" style="display: none;">
    <div class="wrong-answers-title">Review Your Mistakes</div>
    <div id="wrongAnswersList"></div>
  </div>
  
  <div class="result-actions">
    <button class="btn-primary" id="nextUnitBtn" onclick="goToNextUnit()" style="display:none;">Next Unit ‚Üí</button>
    <button class="btn-secondary" onclick="reviewMistakes()" id="reviewMistakesBtn">Review Mistakes</button>
    <button class="btn-secondary" onclick="retrySession()">Try Again</button>
    <button class="btn-secondary" onclick="goHome()">Home</button>
  </div>
</div>

<!-- MOCK -->
<div id="screen-mock" class="screen mock-screen-compact">
  <div class="header">
    <div class="logo" onclick="goHome()" style="cursor:pointer"><img src="/images/logo.png" alt="Fujisan.AI" class="logo-img" style="height:130px;"></div>
    <div class="header-right">
      <select class="lang-selector" onchange="changeLang(this.value)">
        <option value="en">EN</option>
        <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="id" disabled>Indonesia (Ê∫ñÂÇô‰∏≠)</option>
      </select>
      <button class="header-btn" onclick="event.stopPropagation(); showScreen('settings')"><svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align:-2px"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>
  
  <!-- Level Selection -->
  <div class="dash-level-row" id="mock-levels">
    <button class="level-select-btn active" data-level="N5">N5</button>
    <button class="level-select-btn" data-level="N4">N4</button>
    <button class="level-select-btn" data-level="N3">N3</button>
    <button class="level-select-btn" data-level="N2">N2</button>
    <button class="level-select-btn" data-level="N1">N1</button>
  </div>
  
  <nav class="nav-bar nav-bar-3">
    <button class="nav-btn" data-screen="drill"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M4 4h6c1.1 0 2 .9 2 2v14c0-.55-.45-1-1-1H4V4zm16 0h-6c-1.1 0-2 .9-2 2v14c0-.55.45-1 1-1h7V4z"/></svg></span>Drill</button>
    <button class="nav-btn active" data-screen="mock"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg></span>Mock</button>
    <button class="nav-btn" data-screen="ai"><span class="nav-icon ai-nav-icon"></span>AI</button>
  </nav>
  
  <!-- Mock Content Area -->
  <div class="mock-content">
    <!-- Quick Start Card -->
    <div class="mock-quick-card">
      <div class="mock-quick-header">
        <span class="mock-quick-level" id="mock-level-badge">N5</span>
        <span class="mock-quick-title">Mock Test</span>
      </div>
      <div class="mock-quick-stats">
        <div class="mock-quick-stat"><span class="mock-stat-num" id="mock-q-count">91</span><span class="mock-stat-label">Q</span></div>
        <div class="mock-quick-divider"></div>
        <div class="mock-quick-stat"><span class="mock-stat-num" id="mock-time">105</span><span class="mock-stat-label">min</span></div>
      </div>
      <button class="mock-start-btn" onclick="startMock()">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M8 5v14l11-7z"/></svg>
        Start Test
      </button>
    </div>
    
    <!-- Mode & Set Selection -->
    <div class="mock-options">
      <div class="mock-option-row">
        <span class="mock-option-label">Mode</span>
        <div class="mock-option-toggle">
          <button class="mock-toggle-btn active" data-mode="full" onclick="selectMockMode('full')">Full</button>
          <button class="mock-toggle-btn" data-mode="section" onclick="selectMockMode('section')">Section</button>
        </div>
      </div>
      
      <!-- Section Selection (hidden by default) -->
      <div class="mock-section-select hidden" id="mockSectionSelect">
        <div class="mock-section-pills">
          <button class="mock-pill" data-section="moji" onclick="selectMockSection(this)"><span data-i18n="sectionMoji">ÊñáÂ≠ó</span></button>
          <button class="mock-pill" data-section="bunpou" onclick="selectMockSection(this)"><span data-i18n="sectionBunpou">ÊñáÊ≥ï</span></button>
          <button class="mock-pill" data-section="choukai" onclick="selectMockSection(this)"><span data-i18n="sectionChoukai">ËÅ¥Ëß£</span></button>
        </div>
      </div>
      
      <div class="mock-option-row">
        <span class="mock-option-label">Set</span>
        <select class="mock-set-select" id="mockSetSelect" onchange="selectMockSet(this.value)">
          <option value="1" selected>Set 1</option>
          <option value="2">Set 2</option>
          <option value="3">Set 3</option>
          <option value="4">Set 4</option>
          <option value="5">Set 5</option>
          <option value="6">Set 6</option>
          <option value="7">Set 7</option>
          <option value="8">Set 8</option>
          <option value="9">Set 9</option>
          <option value="10">Set 10</option>
          <option value="11">Set 11</option>
          <option value="12">Set 12</option>
          <option value="13">Set 13</option>
          <option value="14">Set 14</option>
          <option value="15">Set 15</option>
          <option value="16">Set 16</option>
          <option value="17">Set 17</option>
          <option value="18">Set 18</option>
          <option value="19">Set 19</option>
          <option value="20">Set 20</option>
          <option value="random">üé≤ Random</option>
        </select>
      </div>
    </div>
    
    <!-- Recent Score (if exists) -->
    <div class="mock-recent" id="mockRecent" style="display:none;">
      <div class="mock-recent-label">Last Score</div>
      <div class="mock-recent-score" id="mockRecentScore">--</div>
    </div>
  </div>
</div>

<!-- MOCK-Q (JLPT Format) -->
<div id="screen-mock-q" class="screen">
  <div class="timer" id="timer">105:00</div>
  <div class="mock-section-header" id="mockSectionHeader">
    <div class="mock-section-current" id="mockSectionCurrent">Ë®ÄË™ûÁü•Ë≠òÔºàÊñáÂ≠ó„ÉªË™ûÂΩôÔºâ</div>
    <div class="mock-subsection-current" id="mockSubsectionCurrent">„ÇÇ„Çì„Å†„ÅÑ1</div>
  </div>
  <div class="q-header">
    <button class="back-btn" onclick="confirmExitMock()">‚Üê</button>
    <div class="q-title">Mock Test</div>
    <div class="q-progress" id="mock-progress">1/91</div>
  </div>
  <div class="q-card mock-q-card">
    <div class="mock-q-instruction" id="mock-instruction"></div>
    <div class="mock-q-text" id="mock-question-text"></div>
    <audio id="mockAudio" style="display:none"></audio>
    <button class="audio-btn mock-audio-btn hidden" id="mockAudioBtn" onclick="playMockAudio()">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
      Play Audio
    </button>
  </div>
  <div class="options mock-options" id="mock-options"></div>
  <div class="mock-nav-btns">
    <button class="mock-nav-btn" id="mockPrevBtn" onclick="mockPrevQuestion()" disabled>‚Üê Previous</button>
    <button class="mock-nav-btn" id="mockNextBtn" onclick="mockNextQuestion()">Next ‚Üí</button>
  </div>
</div>

<!-- MOCK RESULT -->
<div id="screen-mock-result" class="screen">
  <div class="q-header">
    <button class="back-btn" onclick="showScreen('mock')">‚Üê</button>
    <div class="q-title">Mock Test Result</div>
  </div>
  
  <!-- Score Card -->
  <div class="mock-result-card">
    <div class="mock-result-icon" id="mock-result-icon">üéâ</div>
    <div class="mock-result-score" id="mock-result-score">0%</div>
    <div class="mock-result-label" id="mock-result-label">ÂêàÊ†º PASSED!</div>
    <div class="mock-result-stats" id="mock-result-stats"></div>
  </div>
  
  <!-- Section Breakdown -->
  <div class="mock-section-breakdown" id="mock-section-breakdown"></div>
  
  <!-- AI Study Guidance -->
  <div class="ai-guidance-card" id="ai-guidance-card">
    <div class="ai-guidance-title">ü§ñ AI Study Guidance</div>
    <div class="ai-guidance-content" id="ai-guidance-content">Analyzing your results...</div>
  </div>
  
  <!-- Wrong Answers with Explanations -->
  <div class="mock-explanations" id="mock-explanations">
    <div class="mock-explanations-title">üìù Review & Explanations</div>
    <div class="mock-explanations-list" id="mock-explanations-list"></div>
  </div>
  
  <!-- Actions -->
  <div class="mock-result-actions">
    <button class="btn-primary" onclick="startMock()">Try Again</button>
    <button class="btn-secondary" onclick="showScreen('mock')">Back to Mock Tests</button>
    <button class="btn-secondary" onclick="showScreen('drill')">Practice Weak Areas</button>
  </div>
</div>

<!-- AI -->
<div id="screen-ai" class="screen">
  <div class="header">
    <div class="logo" onclick="goHome()" style="cursor:pointer"><img src="/images/logo.png" alt="Fujisan.AI" class="logo-img" style="height:130px;"></div>
    <div class="header-right">
      <select class="lang-selector" onchange="changeLang(this.value)">
        <option value="en">EN</option>
        <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="id" disabled>Indonesia (Ê∫ñÂÇô‰∏≠)</option>
      </select>
      <button class="header-btn" onclick="event.stopPropagation(); showScreen('settings')"><svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align:-2px"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>
  <nav class="nav-bar nav-bar-3">
    <button class="nav-btn" data-screen="drill"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M4 4h6c1.1 0 2 .9 2 2v14c0-.55-.45-1-1-1H4V4zm16 0h-6c-1.1 0-2 .9-2 2v14c0-.55.45-1 1-1h7V4z"/></svg></span>Drill</button>
    <button class="nav-btn" data-screen="mock"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg></span>Mock</button>
    <button class="nav-btn active" data-screen="ai"><span class="nav-icon ai-nav-icon"></span>AI</button>
  </nav>
  
  <!-- AI Tutor Locked State -->
  <div id="aiLocked">
    <div class="ai-card"><div class="ai-title">AI Study Coach</div><div class="ai-desc">Your personal guide grounded in Second Language Acquisition science. Evidence-based support for your learning journey.</div><div class="ai-badge">Premium Feature</div></div>
    <div class="ai-features">
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/><path d="M12 12L20.5 3.5"/><circle cx="12" cy="12" r="3"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Science-Based Explanations</div><div class="ai-feature-desc">Understanding builds stronger memories than memorization</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Personalized Scaffolding</div><div class="ai-feature-desc">Guidance tailored to your current level (i+1)</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Growth-Focused Coaching</div><div class="ai-feature-desc">Frame challenges as opportunities, not obstacles</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">24/7 Support</div><div class="ai-feature-desc">Questions at 2am? Your coach is always here</div></div></div>
    </div>
    <button class="btn-primary" style="margin-top:20px" onclick="openSubscriptionModal()">Upgrade to Premium</button>
  </div>
  
  <!-- AI Tutor Unlocked State -->
  <div id="aiUnlocked" style="display:none;">
    <div class="ai-card" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);">
      <div class="ai-title" style="color:white;">AI Study Coach</div>
      <div class="ai-desc" style="color:rgba(255,255,255,0.9);">Your guide through the language acquisition journey</div>
    </div>
    
    <div id="aiChatHistory" style="flex:1;overflow-y:auto;padding:12px 0;max-height:400px;"></div>
    
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:auto;">
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        <button class="ai-quick-btn" onclick="askAI('Analyze my growth areas and suggest focus points')">üìä My Growth Areas</button>
        <button class="ai-quick-btn" onclick="askAI('Give me evidence-based study strategies for ' + state.level)">üìö Study Science</button>
        <button class="ai-quick-btn" onclick="askAI('Help me understand common error patterns in Japanese learning')">üß† Error Patterns</button>
      </div>
      <div style="display:flex;gap:8px;">
        <input type="text" id="aiInput" placeholder="Ask about grammar, vocabulary, or learning strategies..." style="flex:1;padding:12px;border:1px solid var(--border);border-radius:12px;font-size:15px;" onkeypress="if(event.key==='Enter')sendAIMessage()">
        <button onclick="sendAIMessage()" style="padding:12px 20px;background:var(--primary);color:white;border:none;border-radius:12px;font-weight:600;">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div id="screen-settings" class="screen settings-fixed">
  <div class="settings-header">
    <button class="back-btn" onclick="showScreen('drill')">‚Üê</button>
    <div class="settings-title">Settings</div>
  </div>
  
  <div class="settings-content">
    <!-- Referral Section -->
    <div class="settings-section" style="background:linear-gradient(135deg, rgba(240,147,251,0.1), rgba(245,87,108,0.1));border-radius:16px;padding:16px;margin-bottom:16px;">
      <div class="settings-section-title" style="color:#f5576c;display:flex;align-items:center;gap:8px;"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#f5576c" stroke-width="2"><path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>Invite Friends</div>
      <div class="setting-item" style="background:rgba(255,255,255,0.8);border-radius:12px;">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Your Referral Link</div>
          <div class="setting-desc" id="myReferralCode" style="font-weight:700;color:#667eea;font-size:14px;">Loading...</div>
        </div>
        <button class="setting-action-btn" onclick="copyReferralCode()" style="background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;">Copy</button>
      </div>
      <!-- Referral Status -->
      <div id="referralStatus" style="display:none;margin-top:8px;padding:10px;background:rgba(52,199,89,0.1);border-radius:10px;font-size:12px;">
        <div style="color:#34c759;font-weight:600;">‚úÖ You were referred!</div>
        <div style="color:#666;margin-top:4px;" id="referralBonusText">30-day free trial active</div>
      </div>
      <div style="font-size:12px;color:var(--secondary);margin-top:8px;text-align:center;">
        Share with friends ‚Üí They get 30-day free trial ‚Üí You get 1 month free when they subscribe!
      </div>
    </div>
    
    <!-- Account Section -->
    <div class="settings-section">
      <div class="settings-section-title">Account</div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Email</div>
          <div class="setting-desc" id="settingsEmail">Not logged in</div>
        </div>
      </div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Current Plan</div>
          <div class="setting-desc" id="settingsPlanDesc">Free Trial</div>
        </div>
        <button class="setting-action-btn" onclick="openSubscriptionModal()">Upgrade</button>
      </div>
    </div>
    
    <!-- Study Settings -->
    <div class="settings-section">
      <div class="settings-section-title">Study Settings</div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Questions per Unit</div>
          <div class="setting-desc">Items in each session</div>
        </div>
        <select class="setting-select" id="q-count" onchange="changeQCount(this.value)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="22" selected>22 (1 Unit)</option>
        </select>
      </div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Sound Effects</div>
          <div class="setting-desc">Quiz sounds</div>
        </div>
        <label class="setting-toggle">
          <input type="checkbox" id="sound-toggle" checked onchange="toggleSound(this.checked)">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <!-- Data Section -->
    <div class="settings-section">
      <div class="settings-section-title">Data</div>
      <div class="setting-item" onclick="resetProgress()" style="cursor:pointer">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Reset Progress</div>
          <div class="setting-desc">Clear all learning data</div>
        </div>
        <span class="setting-arrow">‚Ä∫</span>
      </div>
      <div class="setting-item" onclick="logout()" style="cursor:pointer">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
        <div class="setting-info">
          <div class="setting-title" style="color:var(--primary)">Log Out</div>
          <div class="setting-desc">Sign out of your account</div>
        </div>
        <span class="setting-arrow">‚Ä∫</span>
      </div>
    </div>
    
    <!-- App Info -->
    <div class="settings-footer">
      <div class="app-version">Fujisan.AI v<span id="app-version-display">17.3.8</span></div>
      <div class="app-links">
        <a href="privacy.html">Privacy</a> ¬∑ <a href="terms.html">Terms</a>
      </div>
      <div class="app-links" style="margin-top:8px;">
        <a href="mailto:support@fujisan.ai">Support</a> ¬∑ <a href="help.html">Help</a>
      </div>
      <div class="app-links" style="margin-top:8px;font-size:11px;opacity:0.6;">
        <a href="#" onclick="openCustomerPortal(); return false;">Manage Subscription</a>
      </div>
    </div>
  </div>
</div>

<!-- Subscription Modal -->
<div class="modal-overlay hidden" id="subscriptionModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">Choose Your Plan</span>
      <button class="modal-close" onclick="closeSubscriptionModal()">√ó</button>
    </div>
    <p style="font-size:13px;color:var(--text-light);margin-bottom:16px;">7-day free trial ‚Ä¢ Cancel anytime</p>
    
    <div class="plan-card" onclick="selectPlan('basic')">
      <div class="plan-name">Basic</div>
      <div class="plan-price">$47.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $7.99/month</div>
      <ul class="plan-features">
        <li>JLPT N5-N3 content</li>
        <li>Learn / Practice / Review / Test</li>
        <li>Progress tracking</li>
        <li>Unlimited study</li>
      </ul>
    </div>
    
    <div class="plan-card featured" onclick="selectPlan('standard')">
      <div class="plan-name">Standard</div>
      <div class="plan-price">$89.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $14.99/month</div>
      <ul class="plan-features">
        <li>Everything in Basic</li>
        <li>Smart Review (AI-powered)</li>
        <li>Pass probability prediction</li>
        <li>Full mock tests</li>
      </ul>
    </div>
    
    <div class="plan-card" onclick="selectPlan('premium')">
      <div class="plan-name">Premium</div>
      <div class="plan-price">$179.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $29.99/month</div>
      <ul class="plan-features">
        <li>Everything in Standard</li>
        <li>AI Tutor (Japanese Q&A)</li>
        <li>All JLPT levels (N5-N1)</li>
        <li>Priority support</li>
      </ul>
    </div>
    
    <button class="btn-secondary" style="width:100%;margin-top:12px" onclick="closeSubscriptionModal()">Maybe Later</button>
  </div>
</div>

<!-- Subscription Required Modal (for users without plan) -->
<div class="modal-overlay hidden" id="subscriptionRequiredModal">
  <div class="modal-box" style="text-align:center;">
    <div class="modal-icon" style="margin-bottom:16px;"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
    <h2 style="font-size:22px;font-weight:700;margin-bottom:8px;">Start Your Free Trial</h2>
    <p style="font-size:14px;color:var(--text-secondary);margin-bottom:20px;line-height:1.5;">
      Get <strong>full access</strong> to all JLPT levels, Mock Tests, and AI Tutor for <strong>7 days free</strong>.
    </p>
    
    <div style="background:var(--bg);border-radius:12px;padding:16px;margin-bottom:20px;text-align:left;">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <span style="font-size:20px;">‚úÖ</span>
        <span style="font-size:14px;">All N5-N1 vocabulary, kanji & grammar</span>
      </div>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <span style="font-size:20px;">‚úÖ</span>
        <span style="font-size:14px;">20 full Mock Tests per level</span>
      </div>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <span style="font-size:20px;">‚úÖ</span>
        <span style="font-size:14px;">AI Tutor explains every mistake</span>
      </div>
      <div style="display:flex;align-items:center;gap:12px;">
        <span style="font-size:20px;">‚úÖ</span>
        <span style="font-size:14px;">Cancel anytime before trial ends</span>
      </div>
    </div>
    
    <a href="index.html#pricing" class="btn-primary" style="display:block;width:100%;padding:16px;font-size:16px;text-decoration:none;border-radius:12px;">
      Start 7-Day Free Trial
    </a>
    <p style="font-size:12px;color:var(--text-tertiary);margin-top:12px;">
      üí≥ Card required ‚Ä¢ No charge until trial ends
    </p>
    
    <button class="btn-secondary" style="width:100%;margin-top:12px;padding:12px;" onclick="closeSubscriptionRequiredModal()">Maybe Later</button>
  </div>
</div>

<!-- Pass Report Modal -->
<div class="pass-modal hidden" id="passReportModal">
  <div class="pass-modal-box">
    <div class="pass-modal-header">
      <span class="pass-modal-title">Report Your Success</span>
      <button class="pass-modal-close" onclick="closePassReportModal()">√ó</button>
    </div>
    
    <p style="font-size:13px;color:var(--text-light);margin-bottom:20px;">Congratulations on passing JLPT! Share your success and get 3 months free as a thank you.</p>
    
    <form id="passReportForm" onsubmit="submitPassReport(event)">
      <div class="pass-form-group">
        <label class="pass-form-label">JLPT Level Passed *</label>
        <select class="pass-form-select" id="passLevel" required>
          <option value="">Select level...</option>
          <option value="N5">N5</option>
          <option value="N4">N4</option>
          <option value="N3">N3</option>
          <option value="N2">N2</option>
          <option value="N1">N1</option>
        </select>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Score (optional)</label>
        <input type="text" class="pass-form-input" id="passScore" placeholder="e.g., 120/180">
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Display Name *</label>
        <input type="text" class="pass-form-input" id="passName" placeholder="How should we call you?" required>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Country/Region</label>
        <input type="text" class="pass-form-input" id="passCountry" placeholder="e.g., Taiwan, Vietnam, Korea">
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Message (will be shown on our website)</label>
        <textarea class="pass-form-textarea" id="passComment" placeholder="Share your experience with Fujisan.AI..."></textarea>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Certificate Photo (optional)</label>
        <div class="pass-upload-area" id="passUploadArea" onclick="document.getElementById('passCertFile').click()">
          <div class="pass-upload-icon"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#667eea" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg></div>
          <div class="pass-upload-text">Click to upload your certificate</div>
          <img id="passPreview" class="pass-preview" style="display:none;">
        </div>
        <input type="file" id="passCertFile" accept="image/*" style="display:none;" onchange="previewCertificate(this)">
      </div>
      
      <p style="font-size:11px;color:var(--text-light);margin-bottom:12px;">By submitting, you agree that your name, message, and photo may be displayed on our website.</p>
      
      <button type="submit" class="pass-submit-btn" id="passSubmitBtn">Submit Report</button>
    </form>
  </div>
</div>

<!-- Data will be loaded dynamically -->
<!-- Fallback: Load all drill data upfront for standalone HTML -->
<script src="data/n5/vocab.js"></script>
<script src="data/n5/kanji.js"></script>
<script src="data/n5/grammar.js"></script>
<script src="data/n4/vocab.js"></script>
<script src="data/n4/kanji.js"></script>
<script src="data/n4/grammar.js"></script>
<script src="data/n3/vocab.js"></script>
<script src="data/n3/kanji.js"></script>
<script src="data/n3/grammar.js"></script>
<script src="data/n2/vocab.js"></script>
<script src="data/n2/kanji.js"></script>
<script src="data/n2/grammar.js"></script>
<script src="data/n1/vocab.js"></script>
<script src="data/n1/kanji.js"></script>
<script src="data/n1/grammar.js"></script>


<!-- Main Application Script -->
<script src="js/app.js"></script>
</body>
</html>
