<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Fujisan.AI â€” JLPT Learning</title>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WG9LDKZG');</script>
  <!-- End Google Tag Manager -->
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="48x48" href="/images/favicon-48.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
  
  <!-- PWA Meta Tags -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#005BAC">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Fujisan.AI">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  
  <!-- Fonts (Design Guideline) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-vertexai-preview.js"></script>
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WG9LDKZG"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- LOADING OVERLAY - Smooth transition from LP -->
<style>
  @keyframes fadeOutOverlay {
    0%, 80% { opacity: 1; pointer-events: auto; }
    100% { opacity: 0; pointer-events: none; }
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  #app-loading-overlay {
    animation: fadeOutOverlay 2.5s ease-out forwards;
  }
</style>
<div id="app-loading-overlay" style="
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
">
  <div style="text-align: center;">
    <!-- Fuji Logo -->
    <svg viewBox="0 0 24 24" width="80" height="80" style="margin-bottom: 16px;">
      <path fill="white" d="M12 4L2 20h20L12 4zm0 4l6 10H6l6-10z"/>
      <path fill="rgba(255,255,255,0.3)" d="M12 4L8 10h8L12 4z"/>
    </svg>
    <div style="color: white; font-size: 24px; font-weight: 700; margin-bottom: 8px;">Fujisan.AI</div>
    <div style="color: rgba(255,255,255,0.8); font-size: 14px;">Loading your study progress...</div>
    <!-- Spinner -->
    <div style="margin-top: 24px;">
      <div style="
        width: 32px;
        height: 32px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto;
      "></div>
    </div>
  </div>
</div>

<!-- ONBOARDING -->
<div id="onboarding-overlay" class="onboarding-overlay" style="display:none;">
  <div class="onboarding-container">
    <!-- Step indicators -->
    <div class="onboarding-dots">
      <span class="onboarding-dot active" data-step="1"></span>
      <span class="onboarding-dot" data-step="2"></span>
      <span class="onboarding-dot" data-step="3"></span>
      <span class="onboarding-dot" data-step="4"></span>
      <span class="onboarding-dot" data-step="5"></span>
      <span class="onboarding-dot" data-step="6"></span>
    </div>
    
    <!-- Step 1: Welcome -->
    <div class="onboarding-step active" data-step="1">
      <div class="onboarding-icon">
        <svg viewBox="0 0 24 24" width="80" height="80">
          <path fill="#005BAC" d="M12 4L2 20h20L12 4zm0 4l6 10H6l6-10z"/>
          <path fill="#e6f0f9" d="M12 4L8 10h8L12 4z"/>
        </svg>
      </div>
      <h1 class="onboarding-title" data-i18n="onboarding_welcome">Welcome to Fujisan.AI</h1>
      <p class="onboarding-desc" data-i18n="onboarding_welcome_desc">Your AI-powered JLPT tutor. Master Japanese with personalized learning.</p>
    </div>
    
    <!-- Step 2: AI Features - Your Personal Tutor -->
    <div class="onboarding-step" data-step="2">
      <div class="onboarding-icon">
        <svg viewBox="0 0 24 24" width="72" height="72" fill="none" stroke="#667eea" stroke-width="1.5">
          <rect x="3" y="11" width="18" height="10" rx="2"/>
          <circle cx="8.5" cy="15.5" r="1.5" fill="#667eea"/>
          <circle cx="15.5" cy="15.5" r="1.5" fill="#667eea"/>
          <path d="M12 2v5M8 4l4 3 4-3"/>
          <path d="M9 16h6" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="onboarding-title" data-i18n="onboarding_ai_title">Meet Your AI Tutor</h1>
      <p class="onboarding-desc" data-i18n="onboarding_ai_subtitle">Like having a Japanese teacher available 24/7</p>
      <div class="onboarding-ai-features">
        <div class="ai-feature-item highlight">
          <div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#ff9500" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12" y2="17.01" stroke-linecap="round"/></svg></div>
          <div class="ai-feature-content">
            <strong data-i18n="onboarding_ai_explain">Why? Button</strong>
            <span data-i18n="onboarding_ai_explain_desc">Don't understand an answer? Tap "Why?" for instant AI explanation in your language</span>
          </div>
        </div>
        <div class="ai-feature-item">
          <div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#007aff" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
          <div class="ai-feature-content">
            <strong data-i18n="onboarding_ai_chat">Ask AI Anything</strong>
            <span data-i18n="onboarding_ai_chat_desc">"What's the difference between ã¯ and ãŒ?" - Just ask!</span>
          </div>
        </div>
        <div class="ai-feature-item">
          <div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#34c759" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div>
          <div class="ai-feature-content">
            <strong data-i18n="onboarding_ai_coach">Smart Review</strong>
            <span data-i18n="onboarding_ai_coach_desc">AI tracks your mistakes and creates personalized review sessions</span>
          </div>
        </div>
      </div>
      <div class="ai-feature-note" data-i18n="onboarding_ai_note">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="display:inline-block;vertical-align:middle;margin-right:6px;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>AI features included free with all plans
      </div>
    </div>
    
    <!-- Step 3: Select Level -->
    <div class="onboarding-step" data-step="3">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div>
      <h1 class="onboarding-title" data-i18n="onboarding_goal">What's your goal?</h1>
      <p class="onboarding-desc" data-i18n="onboarding_goal_desc">Select your target JLPT level</p>
      <div class="onboarding-levels">
        <button class="onboarding-level-btn" data-level="N5" onclick="selectOnboardingLevel('N5')">
          <span class="level-tag n5">N5</span>
          <span class="level-name" data-i18n="onboarding_beginner">Beginner</span>
        </button>
        <button class="onboarding-level-btn" data-level="N4" onclick="selectOnboardingLevel('N4')">
          <span class="level-tag n4">N4</span>
          <span class="level-name" data-i18n="onboarding_elementary">Elementary</span>
        </button>
        <button class="onboarding-level-btn" data-level="N3" onclick="selectOnboardingLevel('N3')">
          <span class="level-tag n3">N3</span>
          <span class="level-name" data-i18n="onboarding_intermediate">Intermediate</span>
        </button>
        <button class="onboarding-level-btn" data-level="N2" onclick="selectOnboardingLevel('N2')">
          <span class="level-tag n2">N2</span>
          <span class="level-name" data-i18n="onboarding_advanced">Advanced</span>
        </button>
        <button class="onboarding-level-btn" data-level="N1" onclick="selectOnboardingLevel('N1')">
          <span class="level-tag n1">N1</span>
          <span class="level-name" data-i18n="onboarding_expert">Expert</span>
        </button>
      </div>
    </div>
    
    <!-- Step 4: 3 Ways to Learn -->
    <div class="onboarding-step" data-step="4">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
      <h1 class="onboarding-title" data-i18n="onboarding_features">3 Ways to Learn</h1>
      <div class="onboarding-features">
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div>
          <div class="feature-text">
            <strong data-i18n="onboarding_drill">Drill</strong>
            <span data-i18n="onboarding_drill_desc">Daily vocabulary, kanji & grammar practice</span>
          </div>
        </div>
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
          <div class="feature-text">
            <strong data-i18n="onboarding_mock">Mock Test</strong>
            <span data-i18n="onboarding_mock_desc">Real JLPT format with 20 practice sets</span>
          </div>
        </div>
        <div class="onboarding-feature">
          <div class="feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="8.5" cy="15.5" r="1.5" fill="#667eea"/><circle cx="15.5" cy="15.5" r="1.5" fill="#667eea"/><path d="M12 2v5M8 4l4 3 4-3"/></svg></div>
          <div class="feature-text">
            <strong data-i18n="onboarding_ai">AI Tutor</strong>
            <span data-i18n="onboarding_ai_desc">Get personalized explanations for mistakes</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Step 5: How Units Work -->
    <div class="onboarding-step" data-step="5">
      <h1 class="onboarding-title" data-i18n="onboarding_units_title">Tap a Unit to Start</h1>
      <p class="onboarding-desc" data-i18n="onboarding_units_desc">Each unit contains ~22 questions. Complete units to build your skills!</p>
      <div class="onboarding-unit-demo">
        <div class="unit-demo-row">
          <div class="unit-demo-box">1</div>
          <div class="unit-demo-box">2</div>
          <div class="unit-demo-box">3</div>
          <div class="unit-demo-box">4</div>
          <div class="unit-demo-box">5</div>
        </div>
        <div class="unit-demo-arrow">
          <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="#667eea" stroke-width="2">
            <path d="M12 5v14M5 12l7 7 7-7"/>
          </svg>
        </div>
        <div class="unit-demo-label" data-i18n="onboarding_units_tap">Tap any number to start practicing!</div>
      </div>
    </div>
    
    <!-- Step 6: Ready -->
    <div class="onboarding-step" data-step="6">
      <div class="onboarding-icon"><svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#667eea" stroke-width="1.5"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg></div>
      <h1 class="onboarding-title" data-i18n="onboarding_ready">You're all set!</h1>
      <p class="onboarding-desc" data-i18n="onboarding_ready_desc">Start with Unit 1 and let AI guide your journey to JLPT success.</p>
      <div class="onboarding-tip">
        <strong data-i18n="onboarding_tip"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="display:inline-block;vertical-align:middle;margin-right:4px;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>Pro Tip:</strong> Complete at least 1 unit daily for best results
      </div>
    </div>
    
    <!-- Navigation -->
    <div class="onboarding-nav">
      <button class="onboarding-skip" onclick="skipOnboarding()" data-i18n="onboarding_skip">Skip</button>
      <button class="onboarding-next" onclick="nextOnboardingStep()">
        <span id="onboarding-next-text" data-i18n="onboarding_next">Next</span>
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="screen-drill" class="screen active dashboard-90">
  <!-- Header with Logo, Level Mini, Streak, Settings -->
  <div class="header-90">
    <div class="logo-90" onclick="goHome()" style="cursor:pointer">Fujisan.AI</div>
    <div class="header-right-90">
      <div class="streak-badge" id="streak-badge" title="Study streak">
        <span class="streak-fire">ğŸ”¥</span>
        <span class="streak-count" id="streak-count">0</span>
      </div>
      <div class="level-mini" id="drill-level-row">
        <button class="level-mini-btn active" data-level="N5">N5</button>
        <button class="level-mini-btn" data-level="N4">N4</button>
        <button class="level-mini-btn" data-level="N3">N3</button>
        <button class="level-mini-btn" data-level="N2">N2</button>
        <button class="level-mini-btn" data-level="N1">N1</button>
      </div>
      <button class="header-btn-90" onclick="event.stopPropagation(); showScreen('settings')">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
      </button>
    </div>
  </div>
  
  <!-- Language Swiper -->
  <div class="lang-swiper" id="langSwiper">
    <div class="lang-track">
      <div class="lang-option active" data-lang="en" onclick="selectLangSwipe(this, 'en')">English</div>
      <div class="lang-option" data-lang="zh-CN" onclick="selectLangSwipe(this, 'zh-CN')">ç®€ä½“ä¸­æ–‡</div>
      <div class="lang-option" data-lang="zh-TW" onclick="selectLangSwipe(this, 'zh-TW')">ç¹é«”ä¸­æ–‡</div>
      <div class="lang-option" data-lang="ko" onclick="selectLangSwipe(this, 'ko')">í•œêµ­ì–´</div>
      <div class="lang-option" data-lang="vi" onclick="selectLangSwipe(this, 'vi')">Tiáº¿ng Viá»‡t</div>
      <div class="lang-option" data-lang="id" onclick="selectLangSwipe(this, 'id')">Indonesia</div>
      <div class="lang-option" data-lang="es" onclick="selectLangSwipe(this, 'es')">EspaÃ±ol</div>
      <div class="lang-option" data-lang="pt" onclick="selectLangSwipe(this, 'pt')">PortuguÃªs</div>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="main-content-90">
    
    <!-- AI Hero Card (Primary CTA) -->
    <div class="ai-hero" id="ai-hero">
      <div class="ai-greeting-90" id="ai-greeting-text">Good evening.</div>
      <div class="ai-recommend-text" id="ai-recommend-title">Review 5 items you found challenging.</div>
      <div class="ai-recommend-meta" id="ai-recommend-meta">About 3 minutes</div>
      <button class="ai-start-btn" id="ai-recommend-btn" onclick="startAIRecommendation()">
        <span data-i18n="ai_recommend_start">Start</span>
        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
      </button>
    </div>
    
    <!-- Progress Bar (Subtle) -->
    <div class="progress-row" id="progress-summary">
      <span class="progress-level-90" id="progress-level">N5</span>
      <div class="progress-bar-wrap">
        <div class="progress-bar-fill-90" id="progress-bar-fill" style="width: 0%"></div>
      </div>
      <span class="progress-percent-90" id="progress-percent">0/47 units (0%)</span>
    </div>
    
    <!-- Unit Grid Header -->
    <div class="unit-grid-header">
      <span class="unit-grid-title" data-i18n="units">Units</span>
      <span class="unit-grid-count" id="unit-grid-count">0/47</span>
    </div>
    
    <!-- Category Links (Text links, subtle) -->
    <div class="category-links">
      <a href="#" class="category-link" onclick="event.preventDefault(); selectCategoryAndStart('vocab')">
        <span data-i18n="vocab">Vocabulary</span>
        <span class="category-link-pct" id="vocab-progress">0%</span>
      </a>
      <a href="#" class="category-link" onclick="event.preventDefault(); selectCategoryAndStart('kanji')">
        <span data-i18n="new_kanji">Kanji</span>
        <span class="category-link-pct" id="kanji-progress">0%</span>
      </a>
      <a href="#" class="category-link" onclick="event.preventDefault(); selectCategoryAndStart('grammar')">
        <span data-i18n="grammar">Grammar</span>
        <span class="category-link-pct" id="grammar-progress">0%</span>
      </a>
    </div>
    
    <!-- Habit Tracker (Compact, subtle) -->
    <div class="habit-row" id="habit-tracker">
      <div class="habit-days" id="habit-week"></div>
      <span class="habit-streak-text" id="habit-streak">0 day streak</span>
    </div>
    
    <!-- Feedback Link -->
    <div class="feedback-link-row" id="feedback-link-row" onclick="openFeedbackModal()">
      <svg class="feedback-icon-svg" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
      <span class="feedback-link-text" data-i18n="feedback_cta">How's Fujisan.AI? Share your thoughts â†’</span>
    </div>
    
  </div>
  
  <!-- Footer Navigation -->
  <nav class="footer-nav-90">
    <button class="footer-btn-90 active" data-screen="drill" onclick="showScreen('drill')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 3L2 12h3v9h6v-6h2v6h6v-9h3L12 3z"/></svg>
      <span data-i18n="nav_drill">Drill</span>
    </button>
    <button class="footer-btn-90" data-screen="mock" onclick="showScreen('mock')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg>
      <span data-i18n="nav_mock">Mock</span>
    </button>
    <button class="footer-btn-90" data-screen="talk" onclick="showScreen('talk')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
      <span data-i18n="nav_talk">Talk</span>
    </button>
  </nav>
</div>

<!-- QUIZ (All Modes) -->
<div id="screen-quiz" class="screen quiz-screen">
  <div class="q-header">
    <button class="back-btn" onclick="confirmExit()">â†</button>
    <div class="q-title" id="quiz-title">Drill</div>
    <div class="skill-badge" id="skill-badge">ğŸ‘‚ Listening</div>
    <button class="review-header-btn" id="review-header-btn" onclick="startReview()" style="display:none">ğŸ”„ <span id="review-header-count">0</span></button>
    <div class="q-progress" id="quiz-progress">1/10</div>
  </div>
  <div class="q-card compact">
    <div class="q-prompt" id="quiz-prompt">What does this mean?</div>
    <div class="q-word" id="quiz-word">-</div>
    <div class="q-reading" id="quiz-reading">-</div>
    <button class="audio-btn" id="quiz-audio-btn" onclick="playAudio()" style="display:none">ğŸ”Š Play</button>
  </div>
  <div class="options compact" id="quiz-options"></div>
  
  <!-- Feedback Area (shows after answer) -->
  <div class="feedback-area" id="feedback-area" style="display:none">
    <div class="feedback-result" id="feedback-result">
      <span class="feedback-icon"></span>
      <span class="feedback-text"></span>
    </div>
    <div class="feedback-answer" id="feedback-answer"></div>
    
    <!-- AI Auto Comment (for wrong answers) -->
    <div class="feedback-ai-section" id="feedback-ai-section" style="display:none">
      <div class="feedback-ai-comment" id="feedback-ai-comment">
        <div class="ai-comment-loading">Loading...</div>
      </div>
      
      <!-- Ask More Button (default visible) -->
      <button class="ask-more-btn" id="ask-more-btn" onclick="toggleFollowup()" data-i18n="ask_more">Ask more â†’</button>
      
      <!-- Follow-up Question Input (default hidden) -->
      <div class="feedback-followup" id="feedback-followup" style="display:none">
        <input type="text" class="followup-input" id="followup-input" placeholder="Ask a follow-up question...">
        <button class="followup-btn" id="followup-btn" onclick="askFollowup()">â†’</button>
      </div>
      <div class="followup-response" id="followup-response" style="display:none"></div>
    </div>
  </div>
  
  <!-- Next Button (fixed at bottom, outside feedback-area) -->
  <button class="feedback-next-btn" id="feedback-next-btn" onclick="advanceToNextQuestion()" style="display:none">æ¬¡ã¸ â†’</button>
</div>

<!-- RESULT -->
<div id="screen-result" class="screen">
  <div class="result-card" id="result-card">
    <div class="result-icon" id="result-icon">âœ“</div>
    <div class="result-score" id="result-score">0%</div>
    <div class="result-label" id="result-label">-</div>
    <div class="result-praise" id="result-praise"></div>
    <div class="result-stats">
      <div class="result-stat"><div class="result-stat-value" id="result-correct">0</div><div class="result-stat-label">Correct</div></div>
      <div class="result-stat"><div class="result-stat-value" id="result-wrong">0</div><div class="result-stat-label">Wrong</div></div>
      <div class="result-stat"><div class="result-stat-value" id="result-time">0:00</div><div class="result-stat-label">Time</div></div>
    </div>
  </div>
  
  <!-- AI Coach Feedback Card -->
  <div class="ai-feedback-card" id="ai-feedback-card">
    <div class="ai-feedback-icon">ğŸ’¬</div>
    <div class="ai-feedback-text" id="ai-feedback-text">Great work!</div>
  </div>
  
  <!-- Wrong Answers with AI Explanation -->
  <div class="wrong-answers-section" id="wrongAnswersSection" style="display: none;">
    <div class="wrong-answers-title">Review Your Mistakes</div>
    <div id="wrongAnswersList"></div>
  </div>
  
  <div class="result-actions">
    <button class="btn-primary" id="nextUnitBtn" onclick="goToNextUnit()" style="display:none;">Next Unit â†’</button>
    <button class="btn-secondary" onclick="reviewMistakes()" id="reviewMistakesBtn">Review Mistakes</button>
    <button class="btn-secondary" onclick="retrySession()">Try Again</button>
    <button class="btn-secondary" onclick="goHome()">Home</button>
  </div>
</div>

<!-- MOCK -->
<div id="screen-mock" class="screen dashboard-90">
  <!-- Header with Logo, Level Mini, Settings (same as Drill) -->
  <div class="header-90">
    <div class="logo-90" onclick="goHome()" style="cursor:pointer">Fujisan.AI</div>
    <div class="header-right-90">
      <div class="level-mini" id="mock-level-row">
        <button class="level-mini-btn active" data-level="N5">N5</button>
        <button class="level-mini-btn" data-level="N4">N4</button>
        <button class="level-mini-btn" data-level="N3">N3</button>
        <button class="level-mini-btn" data-level="N2">N2</button>
        <button class="level-mini-btn" data-level="N1">N1</button>
      </div>
      <button class="header-btn-90" onclick="event.stopPropagation(); showScreen('settings')">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
      </button>
    </div>
  </div>
  
  <!-- Language Swiper (same as Drill) -->
  <div class="lang-swiper">
    <div class="lang-track">
      <div class="lang-option active" data-lang="en" onclick="selectLangSwipe(this, 'en')">English</div>
      <div class="lang-option" data-lang="zh-CN" onclick="selectLangSwipe(this, 'zh-CN')">ç®€ä½“ä¸­æ–‡</div>
      <div class="lang-option" data-lang="zh-TW" onclick="selectLangSwipe(this, 'zh-TW')">ç¹é«”ä¸­æ–‡</div>
      <div class="lang-option" data-lang="ko" onclick="selectLangSwipe(this, 'ko')">í•œêµ­ì–´</div>
      <div class="lang-option" data-lang="vi" onclick="selectLangSwipe(this, 'vi')">Tiáº¿ng Viá»‡t</div>
      <div class="lang-option" data-lang="id" onclick="selectLangSwipe(this, 'id')">Indonesia</div>
      <div class="lang-option" data-lang="es" onclick="selectLangSwipe(this, 'es')">EspaÃ±ol</div>
      <div class="lang-option" data-lang="pt" onclick="selectLangSwipe(this, 'pt')">PortuguÃªs</div>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="main-content-90">
    
    <!-- Mock Hero Card (Primary CTA) -->
    <div class="mock-hero" id="mock-hero">
      <div class="mock-hero-level" id="mock-hero-level">N5</div>
      <div class="mock-hero-title" data-i18n="mock_title">Mock Test</div>
      <div class="mock-hero-subtitle" id="mock-hero-subtitle" data-i18n="mock_select_set">Select a set to start</div>
      <button class="ai-start-btn" id="mock-start-btn" onclick="startMock()">
        <span data-i18n="mock_start">Start</span>
        <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
      </button>
    </div>
    
    <!-- Mock Set List -->
    <div class="mock-set-list" id="mock-set-list">
      <!-- Sets will be populated by JS -->
    </div>
    
    <!-- Feedback Link -->
    <div class="feedback-link-row" onclick="openFeedbackModal()">
      <span class="feedback-link-icon">ğŸ’¬</span>
      <span class="feedback-link-text" data-i18n="feedback_cta">How's Fujisan.AI? Share your thoughts â†’</span>
    </div>
    
  </div>
  
  <!-- Footer Navigation -->
  <nav class="footer-nav-90">
    <button class="footer-btn-90" data-screen="drill" onclick="showScreen('drill')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 3L2 12h3v9h6v-6h2v6h6v-9h3L12 3z"/></svg>
      <span data-i18n="nav_drill">Drill</span>
    </button>
    <button class="footer-btn-90 active" data-screen="mock" onclick="showScreen('mock')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg>
      <span data-i18n="nav_mock">Mock</span>
    </button>
    <button class="footer-btn-90" data-screen="talk" onclick="showScreen('talk')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
      <span data-i18n="nav_talk">Talk</span>
    </button>
  </nav>
</div>

<!-- MOCK-Q (JLPT Format) -->
<div id="screen-mock-q" class="screen">
  <div class="timer" id="timer">105:00</div>
  <div class="mock-section-header" id="mockSectionHeader">
    <div class="mock-section-current" id="mockSectionCurrent">è¨€èªçŸ¥è­˜ï¼ˆæ–‡å­—ãƒ»èªå½™ï¼‰</div>
    <div class="mock-subsection-current" id="mockSubsectionCurrent">ã‚‚ã‚“ã ã„1</div>
  </div>
  <div class="q-header">
    <button class="back-btn" onclick="confirmExitMock()">â†</button>
    <div class="q-title">Mock Test</div>
    <div class="q-progress" id="mock-progress">1/91</div>
  </div>
  <div class="q-card mock-q-card">
    <div class="mock-q-instruction" id="mock-instruction"></div>
    <div class="mock-q-text" id="mock-question-text"></div>
    <audio id="mockAudio" style="display:none"></audio>
    <button class="audio-btn mock-audio-btn hidden" id="mockAudioBtn" onclick="playMockAudio()">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
      Play Audio
    </button>
  </div>
  <div class="options mock-options" id="mock-options"></div>
  <div class="mock-nav-btns">
    <button class="mock-nav-btn" id="mockPrevBtn" onclick="mockPrevQuestion()" disabled>â† Previous</button>
    <button class="mock-nav-btn" id="mockNextBtn" onclick="mockNextQuestion()">Next â†’</button>
  </div>
</div>

<!-- MOCK RESULT -->
<div id="screen-mock-result" class="screen">
  <div class="q-header">
    <button class="back-btn" onclick="showScreen('mock')">â†</button>
    <div class="q-title">Mock Test Result</div>
  </div>
  
  <!-- Score Card -->
  <div class="mock-result-card">
    <div class="mock-result-icon" id="mock-result-icon">ğŸ‰</div>
    <div class="mock-result-score" id="mock-result-score">0%</div>
    <div class="mock-result-label" id="mock-result-label">åˆæ ¼ PASSED!</div>
    <div class="mock-result-stats" id="mock-result-stats"></div>
  </div>
  
  <!-- Section Breakdown -->
  <div class="mock-section-breakdown" id="mock-section-breakdown"></div>
  
  <!-- AI Study Guidance -->
  <div class="ai-guidance-card" id="ai-guidance-card">
    <div class="ai-guidance-title">AI Study Guidance</div>
    <div class="ai-guidance-content" id="ai-guidance-content">Analyzing your results...</div>
  </div>
  
  <!-- Wrong Answers with Explanations -->
  <div class="mock-explanations" id="mock-explanations">
    <div class="mock-explanations-title">Review & Explanations</div>
    <div class="mock-explanations-list" id="mock-explanations-list"></div>
  </div>
  
  <!-- Actions -->
  <div class="mock-result-actions">
    <button class="btn-primary" onclick="startMock()">Try Again</button>
    <button class="btn-secondary" onclick="showScreen('mock')">Back to Mock Tests</button>
    <button class="btn-secondary" onclick="showScreen('drill')">Practice Weak Areas</button>
  </div>
</div>

<!-- TALK (AI Conversation Practice) -->
<div id="screen-talk" class="screen dashboard-90">
  <div class="header">
    <div class="logo" onclick="goHome()" style="cursor:pointer"><img src="/images/logo.png" alt="Fujisan.AI" class="logo-img" style="height:130px;"></div>
    <div class="header-right">
      <button class="header-btn" onclick="event.stopPropagation(); showScreen('settings')"><svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align:-2px"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>
  
  <!-- Language Swiper -->
  <div class="lang-swiper">
    <div class="lang-track">
      <div class="lang-option" data-lang="en" onclick="selectLangSwipe(this, 'en')">English</div>
      <div class="lang-option" data-lang="zh-CN" onclick="selectLangSwipe(this, 'zh-CN')">ç®€ä½“ä¸­æ–‡</div>
      <div class="lang-option" data-lang="zh-TW" onclick="selectLangSwipe(this, 'zh-TW')">ç¹é«”ä¸­æ–‡</div>
      <div class="lang-option" data-lang="ko" onclick="selectLangSwipe(this, 'ko')">í•œêµ­ì–´</div>
      <div class="lang-option" data-lang="vi" onclick="selectLangSwipe(this, 'vi')">Tiáº¿ng Viá»‡t</div>
      <div class="lang-option" data-lang="id" onclick="selectLangSwipe(this, 'id')">Indonesia</div>
      <div class="lang-option" data-lang="es" onclick="selectLangSwipe(this, 'es')">EspaÃ±ol</div>
      <div class="lang-option" data-lang="pt" onclick="selectLangSwipe(this, 'pt')">PortuguÃªs</div>
    </div>
  </div>
  
  <!-- Current Level Display (read-only) -->
  <div class="talk-level-display">
    <span class="talk-level-label" data-i18n="talk_current_level">Current Level:</span>
    <span class="talk-level-badge" id="talk-level-badge">N5</span>
  </div>
  
  <div class="main-content-90">
    <!-- Talk Welcome Screen -->
    <div class="talk-welcome" id="talk-welcome">
      <div class="talk-welcome-icon">
        <svg viewBox="0 0 64 64" width="64" height="64"><path fill="none" stroke="#667eea" stroke-width="2" d="M32 8c13.255 0 24 9.85 24 22s-10.745 22-24 22c-3.2 0-6.25-.6-9.05-1.7L12 54l3.7-8.55C11.4 41.65 8 36.1 8 30c0-12.15 10.745-22 24-22z"/><circle cx="20" cy="30" r="3" fill="#667eea"/><circle cx="32" cy="30" r="3" fill="#667eea"/><circle cx="44" cy="30" r="3" fill="#667eea"/></svg>
      </div>
      <h2 class="talk-welcome-title" data-i18n="talk_title">AI Conversation Practice</h2>
      <p class="talk-welcome-desc" data-i18n="talk_desc">Practice Japanese conversation with AI</p>
      
      <!-- Unit-linked Mode Card -->
      <div class="talk-unit-card" id="talk-unit-card">
        <div class="talk-unit-icon">
          <svg viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>
        </div>
        <div class="talk-unit-info">
          <h3 data-i18n="talk_unit_mode">Unit-linked Mode</h3>
          <p id="talk-unit-desc" data-i18n="talk_unit_desc_default">Practice with Unit vocabulary</p>
        </div>
        <button class="talk-unit-btn" onclick="startTalkUnit()">
          <span data-i18n="talk_start">Start</span>
          <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
        </button>
      </div>
      
      <!-- Free Theme Section -->
      <div class="talk-theme-section">
        <h3 class="talk-theme-title" data-i18n="talk_free_theme">Free Theme</h3>
        <div class="talk-theme-grid">
          <div class="talk-theme-card" onclick="startTalkScenario('greeting')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span data-i18n="talk_greeting">Self-intro</span>
          </div>
          <div class="talk-theme-card" onclick="startTalkScenario('restaurant')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
            <span data-i18n="talk_restaurant">Restaurant</span>
          </div>
          <div class="talk-theme-card" onclick="startTalkScenario('shopping')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2zm6 16H6V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h4v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z"/></svg>
            <span data-i18n="talk_shopping">Shopping</span>
          </div>
          <div class="talk-theme-card" onclick="startTalkScenario('directions')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            <span data-i18n="talk_directions">Directions</span>
          </div>
          <div class="talk-theme-card" onclick="startTalkScenario('travel')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>
            <span data-i18n="talk_travel">Travel</span>
          </div>
          <div class="talk-theme-card" onclick="startTalkScenario('free')">
            <svg viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
            <span data-i18n="talk_free">Free Talk</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chat Screen (hidden initially) -->
    <div class="talk-chat" id="talk-chat" style="display:none;">
      <div class="talk-chat-header">
        <button class="talk-back-btn" onclick="exitTalkChat()">
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>
        <div class="talk-chat-title" id="talk-chat-title" data-i18n="talk_chat_title">AI Conversation</div>
        <div class="talk-chat-level" id="talk-chat-level">N5</div>
      </div>
      
      <div class="talk-messages" id="talk-messages"></div>
      
      <div class="talk-suggestions" id="talk-suggestions"></div>
      
      <div class="talk-input-area">
        <button class="talk-voice-btn" id="talk-voice-btn" onclick="toggleTalkVoice()">
          <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>
        </button>
        <div class="talk-input-wrapper">
          <textarea class="talk-input" id="talk-input" placeholder="æ—¥æœ¬èªã§å…¥åŠ›..." data-i18n-placeholder="talk_input_placeholder" rows="1"></textarea>
        </div>
        <button class="talk-send-btn" id="talk-send-btn" onclick="sendTalkMessage()" disabled>
          <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Footer Navigation (for Talk screen) -->
  <nav class="footer-nav-90">
    <button class="footer-btn-90" data-screen="drill" onclick="showScreen('drill')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 3L2 12h3v9h6v-6h2v6h6v-9h3L12 3z"/></svg>
      <span data-i18n="nav_drill">Drill</span>
    </button>
    <button class="footer-btn-90" data-screen="mock" onclick="showScreen('mock')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg>
      <span data-i18n="nav_mock">Mock</span>
    </button>
    <button class="footer-btn-90 active" data-screen="talk" onclick="showScreen('talk')">
      <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
      <span data-i18n="nav_talk">Talk</span>
    </button>
  </nav>
</div>

<!-- AI -->
<div id="screen-ai" class="screen">
  <div class="header">
    <div class="logo" onclick="goHome()" style="cursor:pointer"><img src="/images/logo.png" alt="Fujisan.AI" class="logo-img" style="height:130px;"></div>
    <div class="header-right">
      <button class="header-btn" onclick="event.stopPropagation(); showScreen('settings')"><svg viewBox="0 0 24 24" width="16" height="16" style="vertical-align:-2px"><path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    </div>
  </div>
  
  <!-- Language Swiper -->
  <div class="lang-swiper">
    <div class="lang-track">
      <div class="lang-option" data-lang="en" onclick="selectLangSwipe(this, 'en')">English</div>
      <div class="lang-option" data-lang="zh-CN" onclick="selectLangSwipe(this, 'zh-CN')">ç®€ä½“ä¸­æ–‡</div>
      <div class="lang-option" data-lang="zh-TW" onclick="selectLangSwipe(this, 'zh-TW')">ç¹é«”ä¸­æ–‡</div>
      <div class="lang-option" data-lang="ko" onclick="selectLangSwipe(this, 'ko')">í•œêµ­ì–´</div>
      <div class="lang-option" data-lang="vi" onclick="selectLangSwipe(this, 'vi')">Tiáº¿ng Viá»‡t</div>
      <div class="lang-option" data-lang="id" onclick="selectLangSwipe(this, 'id')">Indonesia</div>
      <div class="lang-option" data-lang="es" onclick="selectLangSwipe(this, 'es')">EspaÃ±ol</div>
      <div class="lang-option" data-lang="pt" onclick="selectLangSwipe(this, 'pt')">PortuguÃªs</div>
    </div>
  </div>
  
  <nav class="nav-bar nav-bar-3">
    <button class="nav-btn" data-screen="drill"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M4 4h6c1.1 0 2 .9 2 2v14c0-.55-.45-1-1-1H4V4zm16 0h-6c-1.1 0-2 .9-2 2v14c0-.55.45-1 1-1h7V4z"/></svg></span>Drill</button>
    <button class="nav-btn" data-screen="mock"><span class="nav-icon"><svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg></span>Mock</button>
    <button class="nav-btn active" data-screen="ai"><span class="nav-icon ai-nav-icon"></span>AI</button>
  </nav>
  
  <!-- AI Tutor Locked State -->
  <div id="aiLocked">
    <div class="ai-card"><div class="ai-title">AI Study Coach</div><div class="ai-desc">Your personal guide grounded in Second Language Acquisition science. Evidence-based support for your learning journey.</div><div class="ai-badge">Premium Feature</div></div>
    <div class="ai-features">
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"/><path d="M12 12L20.5 3.5"/><circle cx="12" cy="12" r="3"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Science-Based Explanations</div><div class="ai-feature-desc">Understanding builds stronger memories than memorization</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Personalized Scaffolding</div><div class="ai-feature-desc">Guidance tailored to your current level (i+1)</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">Growth-Focused Coaching</div><div class="ai-feature-desc">Frame challenges as opportunities, not obstacles</div></div></div>
      <div class="ai-feature"><div class="ai-feature-icon"><svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="#667eea" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div><div class="ai-feature-text"><div class="ai-feature-title">24/7 Support</div><div class="ai-feature-desc">Questions at 2am? Your coach is always here</div></div></div>
    </div>
    <button class="btn-primary" style="margin-top:20px" onclick="openSubscriptionModal()">Upgrade to Premium</button>
  </div>
  
  <!-- AI Tutor Unlocked State -->
  <div id="aiUnlocked" style="display:none;">
    <div class="ai-card" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);">
      <div class="ai-title" style="color:white;">AI Study Coach</div>
      <div class="ai-desc" style="color:rgba(255,255,255,0.9);">Your guide through the language acquisition journey</div>
    </div>
    
    <div id="aiChatHistory" style="flex:1;overflow-y:auto;padding:12px 0;max-height:400px;"></div>
    
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:auto;">
      <div style="display:flex;flex-wrap:wrap;gap:8px;">
        <button class="ai-quick-btn" onclick="askAI('Analyze my growth areas and suggest focus points')">ğŸ“Š My Growth Areas</button>
        <button class="ai-quick-btn" onclick="askAI('Give me evidence-based study strategies for ' + state.level)">ğŸ“š Study Science</button>
        <button class="ai-quick-btn" onclick="askAI('Help me understand common error patterns in Japanese learning')">ğŸ§  Error Patterns</button>
      </div>
      <div style="display:flex;gap:8px;">
        <input type="text" id="aiInput" placeholder="Ask about grammar, vocabulary, or learning strategies..." style="flex:1;padding:12px;border:1px solid var(--border);border-radius:12px;font-size:15px;" onkeypress="if(event.key==='Enter')sendAIMessage()">
        <button onclick="sendAIMessage()" style="padding:12px 20px;background:var(--primary);color:white;border:none;border-radius:12px;font-weight:600;">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div id="screen-settings" class="screen settings-fixed">
  <div class="settings-header">
    <button class="back-btn" onclick="showScreen('drill')">â†</button>
    <div class="settings-title">Settings</div>
  </div>
  
  <div class="settings-content">
    <!-- Referral Section -->
    <div class="settings-section" style="background:linear-gradient(135deg, rgba(240,147,251,0.1), rgba(245,87,108,0.1));border-radius:16px;padding:16px;margin-bottom:16px;">
      <div class="settings-section-title" style="color:#f5576c;display:flex;align-items:center;gap:8px;"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="#f5576c" stroke-width="2"><path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>Invite Friends</div>
      <div class="setting-item" style="background:rgba(255,255,255,0.8);border-radius:12px;">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Your Referral Link</div>
          <div class="setting-desc" id="myReferralCode" style="font-weight:700;color:#667eea;font-size:14px;">Loading...</div>
        </div>
        <button class="setting-action-btn" onclick="copyReferralCode()" style="background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;">Copy</button>
      </div>
      <!-- Referral Status -->
      <div id="referralStatus" style="display:none;margin-top:8px;padding:10px;background:rgba(52,199,89,0.1);border-radius:10px;font-size:12px;">
        <div style="color:#34c759;font-weight:600;">âœ… You were referred!</div>
        <div style="color:#666;margin-top:4px;" id="referralBonusText">30-day free trial active</div>
      </div>
      <div style="font-size:12px;color:var(--secondary);margin-top:8px;text-align:center;">
        Share with friends â†’ They get 30-day free trial â†’ You get 1 month free when they subscribe!
      </div>
    </div>
    
    <!-- Account Section -->
    <div class="settings-section">
      <div class="settings-section-title">Account</div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Email</div>
          <div class="setting-desc" id="settingsEmail">Not logged in</div>
        </div>
      </div>
      <div class="setting-item" id="planSettingItem">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Current Plan</div>
          <div class="setting-desc" id="settingsPlanDesc">Free Trial</div>
        </div>
        <button class="setting-action-btn" id="planActionBtn" onclick="openSubscriptionModal()">Upgrade</button>
      </div>
      <!-- Subscription Status (shown when subscribed) -->
      <div class="setting-item hidden" id="subscriptionStatusItem" style="background:rgba(102,126,234,0.05);">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
        <div class="setting-info">
          <div class="setting-title" id="subscriptionStatusTitle">Active</div>
          <div class="setting-desc" id="subscriptionStatusDesc">Renews on -</div>
        </div>
        <button class="setting-action-btn" id="manageSubBtn" onclick="openCustomerPortal()" style="background:#f3f4f6;color:#374151;">Manage</button>
      </div>
      <!-- Data Retention Info -->
      <div class="setting-item" style="background:rgba(102,126,234,0.03);">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Data Retention</div>
          <div class="setting-desc" style="color:#666;">Your learning progress is stored for 2 years after last activity</div>
        </div>
      </div>
    </div>
    
    <!-- Study Settings -->
    <div class="settings-section">
      <div class="settings-section-title">Study Settings</div>
      <div class="setting-item" onclick="resetStudyGoals()" style="cursor:pointer">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg></div>
        <div class="setting-info">
          <div class="setting-title" data-i18n="settings_reset_goals">Change Study Goals</div>
          <div class="setting-desc" id="currentGoalDisplay" data-i18n="settings_reset_goals_desc">Update target level & exam date</div>
        </div>
        <span class="setting-arrow">â€º</span>
      </div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Questions per Unit</div>
          <div class="setting-desc">Items in each session</div>
        </div>
        <select class="setting-select" id="q-count" onchange="changeQCount(this.value)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="22" selected>22 (1 Unit)</option>
        </select>
      </div>
      <div class="setting-item">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Sound Effects</div>
          <div class="setting-desc">Quiz sounds</div>
        </div>
        <label class="setting-toggle">
          <input type="checkbox" id="sound-toggle" checked onchange="toggleSound(this.checked)">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <!-- Referral Section -->
    <div class="settings-section">
      <div class="settings-section-title">Invite Friends</div>
      <div class="referral-card" style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));border-radius:16px;padding:20px;margin-bottom:8px;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
          <div style="width:48px;height:48px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M20 12v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6"/><rect x="4" y="10" width="16" height="4" rx="1"/><path d="M12 4v6"/><path d="m8 8 4-4 4 4"/></svg>
          </div>
          <div>
            <div style="font-weight:700;font-size:16px;color:var(--text);">Get Free Months!</div>
            <div style="font-size:13px;color:var(--text-secondary);">1 free month per friend who subscribes</div>
          </div>
        </div>
        
        <div style="background:var(--card-bg);border-radius:12px;padding:14px;margin-bottom:12px;">
          <div style="font-size:11px;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Your Referral Link</div>
          <div style="display:flex;gap:8px;align-items:center;">
            <input type="text" id="referralLinkInput" readonly style="flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:8px;font-size:13px;background:var(--bg);color:var(--text);font-family:monospace;">
            <button onclick="copyReferralLink()" style="padding:10px 16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;font-weight:600;font-size:13px;cursor:pointer;white-space:nowrap;display:flex;align-items:center;gap:6px;" id="copyReferralBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              <span>Copy</span>
            </button>
          </div>
        </div>
        
        <div style="display:flex;gap:8px;">
          <button onclick="shareReferralTwitter()" style="flex:1;padding:10px;background:#1DA1F2;color:#fff;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            Share
          </button>
          <button onclick="shareReferralLine()" style="flex:1;padding:10px;background:#06C755;color:#fff;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.349 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg>
            LINE
          </button>
          <button onclick="shareReferralWhatsApp()" style="flex:1;padding:10px;background:#25D366;color:#fff;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            WhatsApp
          </button>
        </div>
        
        <div id="referralStats" style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);display:none;">
          <div style="display:flex;justify-content:space-around;text-align:center;">
            <div>
              <div style="font-size:24px;font-weight:700;color:var(--primary);" id="referralCount">0</div>
              <div style="font-size:11px;color:var(--text-secondary);">Friends Invited</div>
            </div>
            <div>
              <div style="font-size:24px;font-weight:700;color:#16a34a;" id="freeMonthsEarned">0</div>
              <div style="font-size:11px;color:var(--text-secondary);">Free Months Earned</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Data Section -->
    <div class="settings-section">
      <div class="settings-section-title">Data</div>
      <div class="setting-item" onclick="resetProgress()" style="cursor:pointer">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
        <div class="setting-info">
          <div class="setting-title">Reset Progress</div>
          <div class="setting-desc">Clear all learning data</div>
        </div>
        <span class="setting-arrow">â€º</span>
      </div>
      <div class="setting-item" onclick="logout()" style="cursor:pointer">
        <div class="setting-icon"><svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#667eea" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
        <div class="setting-info">
          <div class="setting-title" style="color:var(--primary)">Log Out</div>
          <div class="setting-desc">Sign out of your account</div>
        </div>
        <span class="setting-arrow">â€º</span>
      </div>
    </div>
    
    <!-- App Info -->
    <div class="settings-footer">
      <div class="app-version">Fujisan.AI v<span id="app-version-display">19.1.3</span></div>
      <div class="app-links">
        <a href="privacy.html">Privacy</a> Â· <a href="terms.html">Terms</a>
      </div>
      <div class="app-links" style="margin-top:8px;">
        <a href="mailto:support@fujisan.ai">Support</a> Â· <a href="help.html">Help</a>
      </div>
      <div class="app-links" style="margin-top:8px;">
        <a href="/?preview=true">View Homepage</a>
      </div>
      <div class="app-links" style="margin-top:12px;" id="cancelSubscriptionLink">
        <a href="#" onclick="openCustomerPortal(); return false;" style="color:#dc2626;">Cancel Subscription</a>
      </div>
    </div>
  </div>
</div>

<!-- Cancel Subscription Confirmation Modal -->
<div class="modal-overlay hidden" id="cancelSubscriptionModal">
  <div class="modal-box" style="max-width:400px;">
    <div class="modal-header">
      <span class="modal-title">Cancel Subscription</span>
      <button class="modal-close" onclick="closeCancelModal()">Ã—</button>
    </div>
    <div style="padding:16px 0;">
      <p style="font-size:14px;color:var(--text);margin-bottom:16px;">Are you sure you want to cancel your subscription?</p>
      <div style="background:#f8f9fa;border-radius:12px;padding:16px;margin-bottom:16px;">
        <div style="font-size:13px;color:var(--text-light);margin-bottom:8px;">What happens when you cancel:</div>
        <ul style="font-size:13px;color:var(--text);margin:0;padding-left:20px;">
          <li style="margin-bottom:6px;">âœ“ Access continues until <span id="cancelAccessUntil">-</span></li>
          <li style="margin-bottom:6px;">âœ“ Your learning progress is saved</li>
          <li style="margin-bottom:6px;">âœ“ You can resubscribe anytime</li>
          <li>âœ— No more charges after cancellation</li>
        </ul>
      </div>
      <div style="display:flex;gap:12px;">
        <button onclick="closeCancelModal()" style="flex:1;padding:14px;border-radius:12px;border:1px solid #ddd;background:#fff;font-size:14px;cursor:pointer;">Keep Subscription</button>
        <button onclick="confirmCancelSubscription()" style="flex:1;padding:14px;border-radius:12px;border:none;background:#ef4444;color:#fff;font-size:14px;font-weight:600;cursor:pointer;">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Subscription Modal -->
<div class="modal-overlay hidden" id="subscriptionModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="modal-title">Choose Your Plan</span>
      <button class="modal-close" onclick="closeSubscriptionModal()">Ã—</button>
    </div>
    <p style="font-size:13px;color:var(--text-light);margin-bottom:16px;">7-day free trial â€¢ Cancel anytime</p>
    
    <div class="plan-card" onclick="selectPlan('basic')">
      <div class="plan-name">Basic</div>
      <div class="plan-price">$47.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $7.99/month</div>
      <ul class="plan-features">
        <li>JLPT N5-N3 content</li>
        <li>Learn / Practice / Review / Test</li>
        <li>Progress tracking</li>
        <li>Unlimited study</li>
      </ul>
    </div>
    
    <div class="plan-card featured" onclick="selectPlan('standard')">
      <div class="plan-name">Standard</div>
      <div class="plan-price">$89.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $14.99/month</div>
      <ul class="plan-features">
        <li>Everything in Basic</li>
        <li>Smart Review (AI-powered)</li>
        <li>Pass probability prediction</li>
        <li>Full mock tests</li>
      </ul>
    </div>
    
    <div class="plan-card" onclick="selectPlan('premium')">
      <div class="plan-name">Premium</div>
      <div class="plan-price">$179.99<span>/year</span></div>
      <div style="font-size:12px;color:var(--text-light);">or $29.99/month</div>
      <ul class="plan-features">
        <li>Everything in Standard</li>
        <li>AI Tutor (Japanese Q&A)</li>
        <li>All JLPT levels (N5-N1)</li>
        <li>Priority support</li>
      </ul>
    </div>
    
  </div>
</div>

<!-- Auth Required Modal (Login/Signup/Reset) -->
<div class="modal-overlay hidden" id="authModal">
  <div class="modal-box" style="max-width:400px;">
    
    <!-- Login View -->
    <div id="authLoginView">
      <div class="modal-header">
        <span class="modal-title" data-i18n="auth_login_title">Log In</span>
        <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
      </div>
      
      <p style="font-size:14px;color:var(--text-secondary);margin-bottom:20px;" data-i18n="auth_login_desc">
        Log in to continue learning Japanese
      </p>
      
      <div id="authLoginError" class="auth-error hidden"></div>
      
      <div class="auth-form-group">
        <label class="auth-label">Email</label>
        <input type="email" id="authLoginEmail" class="auth-input" placeholder="your@email.com">
      </div>
      
      <div class="auth-form-group">
        <label class="auth-label">Password</label>
        <input type="password" id="authLoginPassword" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      
      <button class="btn-primary auth-btn" onclick="authLogin()">Log In</button>
      
      <div class="auth-divider"><span>or</span></div>
      
      <button class="btn-google auth-btn" onclick="authLoginGoogle()">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Continue with Google
      </button>
      
      <div class="auth-links">
        <a href="#" onclick="showAuthView('signup'); return false;" data-i18n="auth_no_account">Don't have an account? Sign up</a>
        <a href="#" onclick="showAuthView('reset'); return false;" data-i18n="auth_forgot">Forgot password?</a>
      </div>
    </div>
    
    <!-- Signup View -->
    <div id="authSignupView" class="hidden">
      <div class="modal-header">
        <span class="modal-title" data-i18n="auth_signup_title">Create Account</span>
        <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
      </div>
      
      <p style="font-size:14px;color:var(--text-secondary);margin-bottom:16px;" data-i18n="auth_signup_desc">
        Start your 7-day free trial
      </p>
      
      <div id="authSignupError" class="auth-error hidden"></div>
      
      <div class="auth-form-group">
        <label class="auth-label">Email</label>
        <input type="email" id="authSignupEmail" class="auth-input" placeholder="your@email.com">
      </div>
      
      <!-- Honeypot field - hidden from humans, bots will fill it -->
      <div class="auth-form-group" style="position:absolute;left:-9999px;opacity:0;height:0;overflow:hidden;" aria-hidden="true">
        <label class="auth-label">Website (leave empty)</label>
        <input type="text" id="authSignupWebsite" class="auth-input" tabindex="-1" autocomplete="off">
      </div>
      
      <div class="auth-form-group">
        <label class="auth-label">Password (min 8 characters)</label>
        <input type="password" id="authSignupPassword" class="auth-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      
      <div class="auth-checkbox-group">
        <label><input type="checkbox" id="authAgeCheck"> I am 13 years or older</label>
        <label><input type="checkbox" id="authTermsCheck"> I agree to <a href="https://fujisan.ai/terms" target="_blank">Terms</a> & <a href="https://fujisan.ai/privacy" target="_blank">Privacy Policy</a></label>
        <label><input type="checkbox" id="authRenewalCheck"> I understand subscriptions auto-renew</label>
      </div>
      
      <button class="btn-primary auth-btn" onclick="authSignup()">Create Account & Start Trial</button>
      
      <div class="auth-divider"><span>or</span></div>
      
      <button class="btn-google auth-btn" onclick="authSignupGoogle()">
        <svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
        Continue with Google
      </button>
      
      <p style="font-size:11px;color:var(--text-tertiary);text-align:center;margin-top:12px;">
        ğŸ’³ Card required â€¢ No charge for 7 days
      </p>
      
      <div class="auth-links">
        <a href="#" onclick="showAuthView('login'); return false;" data-i18n="auth_has_account">Already have an account? Log in</a>
      </div>
    </div>
    
    <!-- Password Reset View -->
    <div id="authResetView" class="hidden">
      <div class="modal-header">
        <span class="modal-title" data-i18n="auth_reset_title">Reset Password</span>
        <button class="modal-close" onclick="closeAuthModal()">Ã—</button>
      </div>
      
      <p style="font-size:14px;color:var(--text-secondary);margin-bottom:20px;" data-i18n="auth_reset_desc">
        Enter your email to receive a password reset link
      </p>
      
      <div id="authResetError" class="auth-error hidden"></div>
      <div id="authResetSuccess" class="auth-success hidden"></div>
      
      <div class="auth-form-group">
        <label class="auth-label">Email</label>
        <input type="email" id="authResetEmail" class="auth-input" placeholder="your@email.com">
      </div>
      
      <button class="btn-primary auth-btn" onclick="authResetPassword()">Send Reset Link</button>
      
      <div class="auth-links">
        <a href="#" onclick="showAuthView('login'); return false;" data-i18n="auth_back_login">â† Back to Login</a>
      </div>
    </div>
    
  </div>
</div>

<!-- Subscription Required Modal (for users without plan) -->
<div class="modal-overlay hidden" id="subscriptionRequiredModal">
  <div class="modal-box" style="max-width:480px;max-height:90vh;overflow-y:auto;">
    <div style="text-align:center;margin-bottom:20px;">
      <div class="modal-icon" style="margin-bottom:12px;"><svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="#667eea" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>
      <h2 class="modal-title" style="font-size:20px;font-weight:700;margin-bottom:4px;">Start Your Free Trial</h2>
      <p class="subscription-modal-subtitle" style="font-size:13px;color:var(--text-secondary);">7-day free trial â€¢ Cancel anytime</p>
    </div>
    
    <!-- Notice for returning users (hidden by default) -->
    <div id="returningUserNotice" class="hidden" style="background:#fef3c7;border:1px solid #f59e0b;border-radius:12px;padding:12px;margin-bottom:16px;">
      <div style="display:flex;align-items:flex-start;gap:10px;">
        <span style="font-size:20px;">âš ï¸</span>
        <div>
          <div style="font-weight:600;font-size:13px;color:#92400e;">Returning User Notice</div>
          <div style="font-size:12px;color:#a16207;margin-top:4px;">As a previous subscriber, your new subscription will start immediately with no free trial. Your learning progress has been saved.</div>
        </div>
      </div>
    </div>
    
    <!-- Billing Toggle -->
    <div style="display:flex;justify-content:center;gap:8px;margin-bottom:16px;">
      <button id="billingAnnual" class="billing-toggle active" onclick="setBilling('annual')">Annual <span style="color:#16a34a;font-size:11px;">Save 50%</span></button>
      <button id="billingMonthly" class="billing-toggle" onclick="setBilling('monthly')">Monthly</button>
    </div>
    
    <!-- Plan Cards -->
    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
      
      <!-- Basic -->
      <div class="plan-select-card" onclick="selectPlanAndGo('basic')">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;font-size:15px;">Basic</div>
            <div style="font-size:12px;color:var(--text-tertiary);">N5-N3 â€¢ Drill & Review</div>
          </div>
          <div style="text-align:right;">
            <div class="plan-price-annual" style="font-weight:700;font-size:16px;">$47.99<span style="font-size:12px;font-weight:400;">/year</span></div>
            <div class="plan-price-monthly hidden" style="font-weight:700;font-size:16px;">$7.99<span style="font-size:12px;font-weight:400;">/month</span></div>
            <div class="plan-price-annual" style="font-size:11px;color:var(--text-tertiary);">$4/month</div>
            <div class="plan-price-monthly hidden" style="font-size:11px;color:var(--text-tertiary);">billed monthly</div>
          </div>
        </div>
      </div>
      
      <!-- Standard (Recommended) -->
      <div class="plan-select-card featured" onclick="selectPlanAndGo('standard')">
        <div style="position:absolute;top:-8px;right:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:10px;padding:2px 8px;border-radius:10px;font-weight:600;">POPULAR</div>
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;font-size:15px;">Standard</div>
            <div style="font-size:12px;color:var(--text-tertiary);">N5-N1 â€¢ Mock Tests â€¢ AI Review</div>
          </div>
          <div style="text-align:right;">
            <div class="plan-price-annual" style="font-weight:700;font-size:16px;">$89.99<span style="font-size:12px;font-weight:400;">/year</span></div>
            <div class="plan-price-monthly hidden" style="font-weight:700;font-size:16px;">$14.99<span style="font-size:12px;font-weight:400;">/month</span></div>
            <div class="plan-price-annual" style="font-size:11px;color:var(--text-tertiary);">$7.50/month</div>
            <div class="plan-price-monthly hidden" style="font-size:11px;color:var(--text-tertiary);">billed monthly</div>
          </div>
        </div>
      </div>
      
      <!-- Premium -->
      <div class="plan-select-card" onclick="selectPlanAndGo('premium')">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-weight:600;font-size:15px;">Premium</div>
            <div style="font-size:12px;color:var(--text-tertiary);">All features â€¢ AI Tutor â€¢ Priority</div>
          </div>
          <div style="text-align:right;">
            <div class="plan-price-annual" style="font-weight:700;font-size:16px;">$179.99<span style="font-size:12px;font-weight:400;">/year</span></div>
            <div class="plan-price-monthly hidden" style="font-weight:700;font-size:16px;">$29.99<span style="font-size:12px;font-weight:400;">/month</span></div>
            <div class="plan-price-annual" style="font-size:11px;color:var(--text-tertiary);">$15/month</div>
            <div class="plan-price-monthly hidden" style="font-size:11px;color:var(--text-tertiary);">billed monthly</div>
          </div>
        </div>
      </div>
      
    </div>
    
    <p id="trialNote" class="subscription-modal-note" style="font-size:11px;color:var(--text-tertiary);text-align:center;margin-bottom:12px;">
      ğŸ’³ Card required â€¢ No charge until trial ends
    </p>
    
    <button class="btn-secondary" style="width:100%;padding:10px;font-size:13px;" onclick="closeSubscriptionRequiredModal()">Log Out</button>
  </div>
</div>

<!-- Feedback Modal -->
<div class="feedback-modal hidden" id="feedbackModal">
  <div class="feedback-modal-box">
    <div class="feedback-modal-header">
      <span class="feedback-modal-title" data-i18n="feedback_title">Share Your Feedback</span>
      <button class="feedback-modal-close" onclick="closeFeedbackModal()">Ã—</button>
    </div>
    
    <p class="feedback-modal-desc" data-i18n="feedback_desc">Your feedback helps us improve Fujisan.AI!</p>
    
    <form id="feedbackForm" onsubmit="submitFeedbackModal(event)">
      <!-- Star Rating -->
      <div class="feedback-form-group">
        <label class="feedback-form-label" data-i18n="feedback_rating">How would you rate Fujisan.AI?</label>
        <div class="feedback-stars" id="feedbackStars">
          <span class="feedback-star" data-rating="1">â˜…</span>
          <span class="feedback-star" data-rating="2">â˜…</span>
          <span class="feedback-star" data-rating="3">â˜…</span>
          <span class="feedback-star" data-rating="4">â˜…</span>
          <span class="feedback-star" data-rating="5">â˜…</span>
        </div>
        <input type="hidden" id="feedbackRating" value="0">
      </div>
      
      <!-- Comment -->
      <div class="feedback-form-group">
        <label class="feedback-form-label" data-i18n="feedback_comment">Your comment</label>
        <textarea class="feedback-form-textarea" id="feedbackComment" placeholder="What do you like? What could be better?" data-i18n-placeholder="feedback_comment_placeholder"></textarea>
      </div>
      
      <!-- Nickname -->
      <div class="feedback-form-group">
        <label class="feedback-form-label" data-i18n="feedback_nickname">Nickname (optional)</label>
        <input type="text" class="feedback-form-input" id="feedbackNickname" placeholder="How should we call you?" data-i18n-placeholder="feedback_nickname_placeholder">
      </div>
      
      <!-- Permission checkbox -->
      <div class="feedback-form-group">
        <label class="feedback-checkbox-label">
          <input type="checkbox" id="feedbackPermission">
          <span data-i18n="feedback_permission">I allow my feedback to be displayed on the website</span>
        </label>
      </div>
      
      <button type="submit" class="feedback-submit-btn" id="feedbackSubmitBtn" data-i18n="feedback_submit">Send Feedback</button>
    </form>
  </div>
</div>

<!-- Pass Report Modal -->
<div class="pass-modal hidden" id="passReportModal">
  <div class="pass-modal-box">
    <div class="pass-modal-header">
      <span class="pass-modal-title">Report Your Success</span>
      <button class="pass-modal-close" onclick="closePassReportModal()">Ã—</button>
    </div>
    
    <p style="font-size:13px;color:var(--text-light);margin-bottom:20px;">Congratulations on passing JLPT! Share your success and get 3 months free as a thank you.</p>
    
    <form id="passReportForm" onsubmit="submitPassReport(event)">
      <div class="pass-form-group">
        <label class="pass-form-label">JLPT Level Passed *</label>
        <select class="pass-form-select" id="passLevel" required>
          <option value="">Select level...</option>
          <option value="N5">N5</option>
          <option value="N4">N4</option>
          <option value="N3">N3</option>
          <option value="N2">N2</option>
          <option value="N1">N1</option>
        </select>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Score (optional)</label>
        <input type="text" class="pass-form-input" id="passScore" placeholder="e.g., 120/180">
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Display Name *</label>
        <input type="text" class="pass-form-input" id="passName" placeholder="How should we call you?" required>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Country/Region</label>
        <input type="text" class="pass-form-input" id="passCountry" placeholder="e.g., Taiwan, Vietnam, Korea">
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Your Message (will be shown on our website)</label>
        <textarea class="pass-form-textarea" id="passComment" placeholder="Share your experience with Fujisan.AI..."></textarea>
      </div>
      
      <div class="pass-form-group">
        <label class="pass-form-label">Certificate Photo (optional)</label>
        <div class="pass-upload-area" id="passUploadArea" onclick="document.getElementById('passCertFile').click()">
          <div class="pass-upload-icon"><svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#667eea" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg></div>
          <div class="pass-upload-text">Click to upload your certificate</div>
          <img id="passPreview" class="pass-preview" style="display:none;">
        </div>
        <input type="file" id="passCertFile" accept="image/*" style="display:none;" onchange="previewCertificate(this)">
      </div>
      
      <p style="font-size:11px;color:var(--text-light);margin-bottom:12px;">By submitting, you agree that your name, message, and photo may be displayed on our website.</p>
      
      <button type="submit" class="pass-submit-btn" id="passSubmitBtn">Submit Report</button>
    </form>
  </div>
</div>

<!-- Data will be loaded dynamically -->
<!-- Fallback: Load all drill data upfront for standalone HTML -->
<script src="data/n5/vocab.js"></script>
<script src="data/n5/kanji.js"></script>
<script src="data/n5/grammar.js"></script>
<script src="data/n4/vocab.js"></script>
<script src="data/n4/kanji.js"></script>
<script src="data/n4/grammar.js"></script>
<script src="data/n3/vocab.js"></script>
<script src="data/n3/kanji.js"></script>
<script src="data/n3/grammar.js"></script>
<script src="data/n2/vocab.js"></script>
<script src="data/n2/kanji.js"></script>
<script src="data/n2/grammar.js"></script>
<script src="data/n1/vocab.js"></script>
<script src="data/n1/kanji.js"></script>
<script src="data/n1/grammar.js"></script>


<!-- Main Application Script -->
<script src="js/app.js"></script>
</body>
</html>
